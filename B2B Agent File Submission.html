<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EME Air International — B2B Agent File Submission</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <style>
    @layer utilities { .perspective-1000 { perspective: 1000px; } }
    @keyframes float { 0%{transform:translateY(0)}50%{transform:translateY(-8px)}100%{transform:translateY(0)} }
    .animate-float { animation: float 6s ease-in-out infinite; }
  </style>
</head>
<body class="antialiased text-gray-900 bg-gray-50">
  <!-- Header -->
  <header class="bg-white py-4 shadow-md">
    <div class="max-w-7xl mx-auto px-6 lg:px-8 flex items-center justify-between">
      <div class="flex items-center gap-4">
        <img src="assets/logo.png" alt="EME Air International" class="h-10 w-10 object-contain rounded-md">
        <div>
          <div class="text-sm font-bold text-yellow-500">EME AIR INTERNATIONAL</div>
          <div class="text-xs text-gray-600">FLY EME, FEEL THE DIFFERENCE</div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-3xl mx-auto py-12 px-6">
    <h2 class="text-2xl font-bold mb-4">EME AIR INTERNATIONAL – B2B Agent File Submission</h2>
    <p class="text-gray-700 mb-6">Welcome B2B Agent. Please complete the form below and upload all required documents for your client.</p>

    <!-- Contact block -->
    <div class="mb-4 text-sm text-gray-700">
      <p>📍 Office: House - 04 (2nd Floor), Road - 12, Sector - 06, Uttara, Dhaka</p>
      <p>📞 +8801614-787836, +8801734-787836, +8801941-038484, +8801400530001</p>
      <p>📧 emeairinternational@gmail.com</p>
      <p class="text-red-500">⚠️ Note: Incomplete forms or missing documents may delay processing.
        All uploads must be in PDF / JPG / PNG format (max 10MB each).</p>
    </div>

    <!-- FORM -->
    <form id="b2bForm" class="space-y-6" onsubmit="return false;">
      <!-- Section 1 -->
      <section>
        <h3 class="text-xl font-semibold mb-3">✈️ Section 1: Customer Details</h3>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">1️⃣ Customer's Full Name (as per passport)</label>
          <input type="text" id="customer_name" name="customer_name" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">2️⃣ Customer's Mobile Number</label>
          <input type="text" id="customer_mobile" name="customer_mobile" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">3️⃣ Customer's Email Address</label>
          <input type="email" id="customer_email" name="customer_email" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">4️⃣ Customer's Passport Number</label>
          <input type="text" id="customer_passport_number" name="customer_passport_number" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>
      </section>

      <!-- Section 2 -->
      <section>
        <h3 class="text-xl font-semibold mb-3">📄 Section 2: Required Documents</h3>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">1️⃣ Customer's Passport
            <br>📂 Upload your valid passport (PDF/JPG)</label>
          <input type="file" id="customer_passport" name="customer_passport" accept=".pdf,image/*" required class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="customer_passport_filename"></span>
		  <div id="customer_passport_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">2️⃣ Customer's Photo
            <br>📂 Upload 1 recent photo (white background, 35×50mm)</label>
          <input type="file" id="customer_photo" name="customer_photo" accept="image/*" required class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="customer_photo_filename"></span>
		  <div id="customer_photo_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">3️⃣ Customer's Visa
            <br>📂 Upload visa copy (PDF/JPG)</label>
          <input type="file" id="customer_visa" name="customer_visa" accept=".pdf,image/*" required class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="customer_visa_filename"></span>
		  <div id="customer_visa_preview" class="hidden"></div>
        </div>
      </section>

      <!-- Section 3 -->
      <section>
        <h3 class="text-xl font-semibold mb-3">📎 Section 3: Additional Documents (If Applicable)</h3>
        
        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">1️⃣ Solvency Certificate
            <br>📂 Upload Solvency Certificate (PDF/JPG)</label>
          <input type="file" id="solvency_certificate" name="solvency_certificate" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="solvency_certificate_filename"></span>
		  <div id="solvency_certificate_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">2️⃣ Bank Statement
            <br>📂 Upload Bank Statement (PDF/JPG)</label>
          <input type="file" id="bank_statement" name="bank_statement" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="bank_statement_filename"></span>
		  <div id="bank_statement_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">3️⃣ Bill Copy
            <br>📂 Upload Bill Copy (PDF/JPG)</label>
          <input type="file" id="bill_copy" name="bill_copy" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="bill_copy_filename"></span>
		  <div id="bill_copy_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">4️⃣ Letter Head
            <br>📂 Upload Letter Head (PDF/JPG)</label>
          <input type="file" id="letter_head" name="letter_head" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="letter_head_filename"></span>
		  <div id="letter_head_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">5️⃣ Visiting Card
            <br>📂 Upload Visiting Card (PDF/JPG)</label>
          <input type="file" id="visiting_card" name="visiting_card" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="visiting_card_filename"></span>
		  <div id="visiting_card_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">6️⃣ Trade License
            <br>📂 Upload Trade License (PDF/JPG)</label>
          <input type="file" id="trade_license" name="trade_license" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="trade_license_filename"></span>
		  <div id="trade_license_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">7️⃣ NOC
            <br>📂 Upload NOC (PDF/JPG)</label>
          <input type="file" id="noc" name="noc" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="noc_filename"></span>
		  <div id="noc_preview" class="hidden"></div>
        </div>

        <div class="mb-3">
          <label class="block text-gray-700 text-sm font-bold mb-2">8️⃣ Office ID
            <br>📂 Upload Office ID (PDF/JPG)</label>
          <input type="file" id="office_id" name="office_id" accept=".pdf,image/*" class="drag-and-drop-file shadow border rounded w-full py-2 px-3 text-gray-700">
		  <span id="office_id_filename"></span>
		  <div id="office_id_preview" class="hidden"></div>
        </div>
      </section>

      <!-- Submit -->
      <div class="text-center">
        <button id="submitBtn" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">Submit Files</button>
      </div>

      <div id="status" class="mt-4 text-center text-sm"></div>
    </form>
  </main>

  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 800, easing: 'ease-in-out', once: false, mirror: false });

    // Helper: read file as base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
          const res = reader.result;
          const parts = res.split(',');
          const meta = parts[0];
          const content = parts[1];
          const mimeMatch = meta.match(/data:(.*);base64/);
          const mimeType = mimeMatch ? mimeMatch[1] : file.type || 'application/octet-stream';
          resolve({ name: file.name, mimeType, content });
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    document.getElementById('submitBtn').addEventListener('click', async function () {
      const statusEl = document.getElementById('status');
      statusEl.innerHTML = '⏳ Preparing your submission...';
      this.disabled = true;

      try {
        // Basic required fields check
        const req = [
          'customer_name','customer_mobile','customer_email','customer_passport_number','customer_passport','customer_photo','customer_visa'
        ];
        for (let id of req) {
          const el = document.getElementById(id);
          if (!el) continue;
          if (el.hasAttribute('required')) {
            if ((el.type === 'file' && el.files.length === 0) || (!el.files && !el.value) || (el.value && el.value.trim() === '')) {
              statusEl.innerHTML = '⚠️ Please fill all required fields and uploads.';
              this.disabled = false;
              return;
            }
          }
        }

        // Collect form data
        const payload = {
          customer_name: document.getElementById('customer_name').value.trim(),
          customer_mobile: document.getElementById('customer_mobile').value.trim(),
          customer_email: document.getElementById('customer_email').value.trim(),
          customer_passport_number: document.getElementById('customer_passport_number').value.trim(),
        };

        // Build list of files to upload
        const filesToRead = [];

        function pushFiles(fieldId, fieldName) {
          const el = document.getElementById(fieldId);
          if (!el) return;
          if (el.files && el.files.length > 0) {
            filesToRead.push({ fieldName, file: el.files[0] });
          }
        }

        // Required files
        pushFiles('customer_passport', 'customer_passport');
        pushFiles('customer_photo', 'customer_photo');
        pushFiles('customer_visa', 'customer_visa');

        // Optional files
        pushFiles('solvency_certificate', 'solvency_certificate');
        pushFiles('bank_statement', 'bank_statement');
        pushFiles('bill_copy', 'bill_copy');
        pushFiles('letter_head', 'letter_head');
        pushFiles('visiting_card', 'visiting_card');
        pushFiles('trade_license', 'trade_license');
        pushFiles('noc', 'noc');
        pushFiles('office_id', 'office_id');

        // Convert each to base64
        const files = [];
        for (let item of filesToRead) {
          const result = await fileToBase64(item.file);
          if (item.file.size > 10 * 1024 * 1024) {
            statusEl.innerHTML = `⚠️ File "${item.file.name}" exceeds 10MB limit. Please compress or upload a smaller file.`;
            this.disabled = false;
            return;
          }
          files.push({
            fieldName: item.fieldName,
            name: result.name,
            mimeType: result.mimeType,
            content: result.content
          });
        }

        payload.files = files;

        // Send to Apps Script
        // ==================================================================================
        // IMPORTANT: PASTE YOUR DEPLOYED GOOGLE APPS SCRIPT URL IN THE LINE BELOW
        // ==================================================================================
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw66Bff5tfSHi0PRiBRFkQXrWSRyUgxE8b-K7WyikyFmGLWfZV_Y8Bo2US3-3Oukbnh/exec';

        statusEl.innerHTML = '🚀 Submitting to EME AIR...';

        await fetch(SCRIPT_URL, {
          method: 'POST',
          mode: 'no-cors', // This prevents the "Failed to fetch" CORS error
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        // Because 'no-cors' mode prevents reading the server's response,
        // we will assume the submission was successful if the fetch command itself doesn't cause an error.
        statusEl.innerHTML = '✅ Files submitted successfully! Our team will review them shortly.';
        document.getElementById('b2bForm').reset();
        
        // Also, let's clear the file previews and names manually after submission
        const fileInputs = document.querySelectorAll('.drag-and-drop-file');
        fileInputs.forEach(input => {
            updateFileDisplay(input);
        });
      } catch (err) {
        console.error(err);
        document.getElementById('status').innerHTML = '❌ Error during submission: ' + err.toString();
      } finally {
        this.disabled = false;
      }
    });

    const dropAreas = document.querySelectorAll('.drag-and-drop-file');

    dropAreas.forEach(area => {
      area.addEventListener('dragover', (event) => {
        event.preventDefault();
        area.classList.add('bg-yellow-100');
      });

      area.addEventListener('dragleave', (event) => {
        event.preventDefault();
        area.classList.remove('bg-yellow-100');
      });

      area.addEventListener('drop', (event) => {
        event.preventDefault();
        area.classList.remove('bg-yellow-100');
        const files = event.dataTransfer.files;
        if (area.tagName === 'INPUT' && area.type === 'file') {
          area.files = files;
          updateFileDisplay(area);
        }
      });

      area.addEventListener('change', (event) => {
        updateFileDisplay(area);
      });
    });

    function updateFileDisplay(inputElement) {
      const filenameSpan = document.getElementById(inputElement.id + '_filename');
      const previewDiv = document.getElementById(inputElement.id + '_preview');
      const file = inputElement.files[0];

      if (file) {
        if (filenameSpan) {
          filenameSpan.textContent = file.name;
        }
        if (previewDiv) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const fileType = file.type;
            let previewContent = '';

            if (fileType.startsWith('image/')) {
              previewContent = `<img src="${e.target.result}" alt="File Preview" class="max-w-full max-h-48">`;
            } else if (fileType === 'application/pdf') {
              previewContent = `<iframe src="${e.target.result}" class="max-w-full max-h-48"></iframe>`;
            } else {
              previewContent = '<span>Unsupported file type for preview</span>';
            }

            previewDiv.innerHTML = previewContent;
            previewDiv.classList.remove('hidden');
          }
          reader.readAsDataURL(file);
        }
      } else {
        if (filenameSpan) {
          filenameSpan.textContent = '';
        }
        if (previewDiv) {
          previewDiv.innerHTML = '';
          previewDiv.classList.add('hidden');
        }
      }
    }
  </script>
  <footer class="bg-white border-t border-gray-200 py-6 mt-16 text-center text-sm text-gray-500">
    <div>📞 01614-787836, 01734-787836 | 📞 01941-038484, 01400-530001</div>
    <div>House -04 (2nd floor), Road -12, Sector -06, Uttara House Building, Uttara, Dhaka, Bangladesh</div>
    <div class="mt-2">&copy; 2025 EME AIR INTERNATIONAL. All rights reserved.</div>
  </footer>
</body>
</html>